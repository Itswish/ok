<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HLS Player — Simple</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    /* theme variables */
    :root{
      --bg-start: #e6f7ff;   /* very light sky */
      --bg-end:   #fff5ee;   /* warm light */
      --accent: #ff1f1f;
      --card-bg: #000;
    }

    /* subtle sky-warm background with printed dots + dark overlay (20%) */
    body{
      margin:0;
      font-family:Inter,Arial,Helvetica,sans-serif;
      background: linear-gradient(180deg,var(--bg-start) 0%, var(--bg-end) 100%);
      color:#111;
      min-height:100vh;
      position:relative;
      background-image:
        radial-gradient(circle at 10% 10%, rgba(255,255,255,0.06) 0.6px, transparent 0.7px),
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.06) 0.6px, transparent 0.7px),
        radial-gradient(circle at 70% 60%, rgba(255,255,255,0.06) 0.6px, transparent 0.7px),
        radial-gradient(circle at 90% 80%, rgba(255,255,255,0.06) 0.6px, transparent 0.7px);
      background-size: 40px 40px, 40px 40px, 40px 40px, 40px 40px;
    }
    /* 20% dark overlay to darken the sky background */
    body::after{
      content:"";
      position:fixed; inset:0;
      background: rgba(0,0,0,0.20);
      pointer-events:none;
      z-index:0;
    }

    .page{max-width:1100px;margin:0 auto;padding:18px;position:relative;z-index:1}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px}
    h1{margin:0;font-size:20px;color:#071427}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    select, button, input[type=text]{padding:8px;border-radius:6px;border:0;background:#111;color:#fff}
    button{cursor:pointer}

    /* player card stays dark for contrast */
    .player-wrap{width:100%;background:var(--card-bg);border-radius:8px;overflow:hidden;margin-bottom:14px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 20px rgba(0,0,0,0.25)}
    .player-wrap video{width:100%;height:100%;display:block;object-fit:cover}
    .aspect-16-9{position:relative;padding-top:56.25%}
    .aspect-16-9 video{position:absolute;top:0;left:0;height:100%;width:100%}
    .aspect-4-3{position:relative;padding-top:75%}
    .aspect-4-3 video{position:absolute;top:0;left:0;height:100%;width:100%}
    .aspect-1-1{position:relative;padding-top:100%}
    .aspect-1-1 video{position:absolute;top:0;left:0;height:100%;width:100%}
    .aspect-fill{height:480px;padding-top:0}
    .aspect-fill video{position:relative;height:100%;width:100%}

    /* 2x2 join buttons */
    .join-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:680px;margin:8px auto}
    .join-btn{display:inline-flex;align-items:center;justify-content:center;background:var(--accent);color:#fff;text-decoration:none;padding:12px;border-radius:8px;font-weight:700;font-size:10px}

    /* promo banner (small) */
    .promo-banner {
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      max-width:900px;
      margin:16px auto;
      padding:10px 18px;
      border-radius:10px;
      background: linear-gradient(90deg, rgba(255,31,31,0.95), rgba(255,80,80,0.95));
      color:#fff;font-weight:800;font-size:13px;text-decoration:none;
      box-shadow:0 8px 20px rgba(255,31,31,0.08);
    }

    /* small utilities */
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
    .light-input{width:60%}

    /* responsive */
    @media (max-width:600px){
      .controls{flex-direction:column;align-items:flex-start}
      .join-grid{grid-template-columns:1fr 1fr;gap:10px;padding:0 8px}
      .light-input{width:100%}
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Aspect & player controls JUST ABOVE PLAYER -->
    <header>
      <h1>Live Stream</h1>
      <div class="controls" aria-hidden="false">
        <label for="aspect">Aspect:</label>
        <select id="aspect" aria-label="Aspect ratio selector">
          <option value="16-9" selected>16:9 (Default)</option>
          <option value="4-3">4:3</option>
          <option value="1-1">1:1 (Square)</option>
          <option value="fill">Fill (stretch)</option>
        </select>

        <button id="cinemaBtn" title="Toggle Cinema">Cinema</button>
        <button id="fsBtn" title="Fullscreen">Fullscreen</button>
        <button id="vrBtn" title="VR Mode">VR</button>
      </div>
    </header>

    <!-- PLAYER -->
    <section id="playerWrap" class="player-wrap aspect-16-9">
      <video id="video" controls playsinline></video>
    </section>

    <!-- Manual URL input (admin can paste signed link) -->
    <div class="row">
      <input id="manualUrl" class="light-input" type="text" placeholder="Paste .m3u8 or .mp4 URL here">
      <button id="loadBtn">Load</button>
    </div>

    <!-- 2x2 promotional buttons -->
    <section class="join-grid" id="joinGrid">
      <a class="join-btn" id="join1" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 1</a>
      <a class="join-btn" id="join2" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 2</a>
      <a class="join-btn" id="join3" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 3</a>
      <a class="join-btn" id="join4" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 4</a>
    </section>

    <!-- PROMO BANNER -->
    <a id="promoBanner" class="promo-banner" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">
      Become Premium — Join Now
    </a>

    <footer style="text-align:center;margin-top:18px;color:#071427;font-weight:700">
      सभी लोग हमारे प्रीमियम सदस्य बनने के लिए JOIN करें
    </footer>
  </div>

<script>
/* ========== CONFIG: just change DEFAULT_STREAM if needed ========== */
const DEFAULT_STREAM = "https://d14v4v80cpjht7.cloudfront.net/file_library/videos/vod_non_drm_hls/migration/6364641427112/6364641427112.m3u8";
/* ========================================================= */

const video = document.getElementById('video');
const wrap = document.getElementById('playerWrap');
const aspect = document.getElementById('aspect');
const manualUrl = document.getElementById('manualUrl');
const loadBtn = document.getElementById('loadBtn');

/* populate manual url initially */
if(DEFAULT_STREAM) manualUrl.value = DEFAULT_STREAM;

/* HLS init and simple manifest encryption detection (keeps original behavior) */
let hls = null;
async function fetchText(url){
  try{
    const resp = await fetch(url, {method:'GET', mode:'cors'});
    if(!resp.ok) throw new Error('HTTP '+resp.status);
    const txt = await resp.text();
    return {ok:true, text:txt};
  }catch(e){
    return {ok:false, error:e};
  }
}
async function checkEncrypted(url){
  try{
    const r = await fetchText(url);
    if(!r.ok) return null;
    const txt = r.text;
    if(txt.includes('#EXT-X-KEY') || txt.includes('SAMPLE-AES') || txt.includes('EXT-X-SESSION-KEY')){
      return true;
    }
    return false;
  }catch(e){
    return null;
  }
}

function setStatusConsole(s){
  console.log('[player] ' + s);
}

async function loadStream(url){
  if(!url) throw new Error('Empty URL');
  setStatusConsole('Checking URL...');
  if(!/^https?:\/\//i.test(url)) throw new Error('Invalid URL (must start with http/https)');
  const isM3u8 = url.toLowerCase().includes('.m3u8');
  const isMp4 = url.toLowerCase().includes('.mp4') || url.toLowerCase().includes('.m4v');

  if(isM3u8){
    setStatusConsole('Fetching manifest...');
    const enc = await checkEncrypted(url);
    if(enc === true){
      throw new Error('Encrypted/DRM stream detected. License required.');
    }
  }

  // destroy previous
  try{ if(hls){ hls.destroy(); hls = null; } } catch(e){}

  if(isM3u8 && Hls.isSupported()){
    hls = new Hls();
    return new Promise((resolve, reject)=>{
      hls.on(Hls.Events.ERROR, function(event, data){
        console.warn('HLS error', data);
        if(data && data.details && data.fatal){
          reject(new Error('HLS fatal error: '+data.details));
        }
      });
      hls.on(Hls.Events.MANIFEST_PARSED, function(){
        setStatusConsole('Playing (HLS)');
        resolve();
      });
      hls.loadSource(url);
      hls.attachMedia(video);
    });
  } else if(isM3u8 && video.canPlayType('application/vnd.apple.mpegurl')){
    video.src = url;
    return new Promise((resolve,reject)=>{
      video.addEventListener('loadedmetadata', function once(){ video.removeEventListener('loadedmetadata',once); setStatusConsole('Playing (native HLS)'); resolve(); });
      video.addEventListener('error', function(){ reject(new Error('Native playback error')); });
    });
  } else if(isMp4){
    video.src = url;
    return new Promise((resolve,reject)=>{
      video.addEventListener('loadedmetadata', function once(){ video.removeEventListener('loadedmetadata',once); setStatusConsole('Playing (MP4)'); resolve(); });
      video.addEventListener('error', function(){ reject(new Error('MP4 playback error')); });
    });
  } else {
    throw new Error('Unknown stream type');
  }
}

/* try to play default on load */
window.addEventListener('load', ()=> {
  if(DEFAULT_STREAM) {
    loadStream(DEFAULT_STREAM).catch(e=>{ console.warn('Default stream failed:', e); });
  }
});

/* manual load button */
loadBtn.addEventListener('click', ()=> {
  const u = manualUrl.value.trim();
  if(!u){ alert('Paste a valid URL'); return; }
  loadStream(u).catch(e=>{ alert('Play failed: '+(e.message||e)); });
});

/* aspect handling (player controls remain just above the player) */
aspect.addEventListener('change', ()=>{
  const v = aspect.value;
  wrap.className = 'player-wrap ' + ({'16-9':'aspect-16-9','4-3':'aspect-4-3','1-1':'aspect-1-1','fill':'aspect-fill'}[v] || 'aspect-16-9');
});

/* cinema & fullscreen toggles */
document.getElementById('cinemaBtn').addEventListener('click', ()=>{ document.body.classList.toggle('cinema-mode'); });
document.getElementById('fsBtn').addEventListener('click', ()=>{ if(!document.fullscreenElement) wrap.requestFullscreen().catch(()=>{}); else document.exitFullscreen().catch(()=>{}); });

/* VR check (informational) */
document.getElementById('vrBtn').addEventListener('click', async ()=>{
  if(navigator.xr && navigator.xr.isSessionSupported){
    try{
      const supported = await navigator.xr.isSessionSupported('immersive-vr');
      if(!supported){ alert('VR not supported on this device/browser'); return; }
      alert('VR supported on this device — full WebXR integration requires additional code.');
    }catch(e){ alert('VR check failed'); }
  } else {
    alert('WebXR/VR not available on this browser.');
  }
});
</script>
</body>
</html>
